<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop to Cart Integration Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .test-section {
            margin: 30px 0;
            padding: 20px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }

        .test-section h2 {
            color: #007bff;
            margin-bottom: 15px;
        }

        .test-item {
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-item strong {
            color: #333;
        }

        .test-item .result {
            margin-left: 20px;
            padding: 10px;
            background: white;
            border-radius: 3px;
            margin-top: 5px;
            font-family: monospace;
            font-size: 0.9em;
        }

        .test-item.pass {
            color: #28a745;
        }

        .test-item.fail {
            color: #dc3545;
        }

        .button-group {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .code-block {
            background: #f4f4f4;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
            border-radius: 3px;
        }

        code {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        ul {
            margin-left: 20px;
        }

        li {
            margin: 8px 0;
        }

        .nav-links {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
        }

        .nav-links a {
            display: inline-block;
            margin-right: 15px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: #0056b3;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        tr:hover {
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõí Shop to Cart Integration Test</h1>
        <p style="color: #666; margin-bottom: 20px;">Test the complete integration between shop.html and cart.html</p>

        <div class="status info">
            ‚ÑπÔ∏è This test page verifies that the shop.js and cart.js integration is working correctly.
        </div>

        <!-- System Status -->
        <div class="test-section">
            <h2>System Status</h2>
            
            <div class="test-item">
                <strong>JavaScript Files Loaded:</strong>
                <div class="result">
                    cart.js: <span id="cart-js-status">checking...</span><br>
                    shop.js: <span id="shop-js-status">checking...</span>
                </div>
            </div>

            <div class="test-item">
                <strong>CartManager Object:</strong>
                <div class="result">
                    Status: <span id="cartmanager-status">checking...</span><br>
                    <span id="cartmanager-details"></span>
                </div>
            </div>

            <div class="test-item">
                <strong>LocalStorage:</strong>
                <div class="result">
                    Available: <span id="storage-status">checking...</span><br>
                    Cart Data: <span id="storage-data">empty</span>
                </div>
            </div>
        </div>

        <!-- Test Suite -->
        <div class="test-section">
            <h2>Integration Tests</h2>
            
            <div class="test-item">
                <strong>1. Test Add Product to Cart</strong>
                <button class="btn-primary" onclick="testAddToCart()">Run Test</button>
                <div class="result" id="test-add-result" style="display:none;"></div>
            </div>

            <div class="test-item">
                <strong>2. Test Product Structure</strong>
                <button class="btn-primary" onclick="testProductStructure()">Run Test</button>
                <div class="result" id="test-structure-result" style="display:none;"></div>
            </div>

            <div class="test-item">
                <strong>3. Test Cart Persistence</strong>
                <button class="btn-primary" onclick="testCartPersistence()">Run Test</button>
                <div class="result" id="test-persistence-result" style="display:none;"></div>
            </div>

            <div class="test-item">
                <strong>4. View LocalStorage Cart Data</strong>
                <button class="btn-primary" onclick="viewCartData()">View</button>
                <div class="result" id="storage-view" style="display:none;"></div>
            </div>
        </div>

        <!-- Product Table -->
        <div class="test-section">
            <h2>Available Products</h2>
            <table id="products-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Product Name</th>
                        <th>Price</th>
                        <th>Image</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody id="products-tbody">
                    <tr><td colspan="5" style="text-align: center;">Loading products...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Instructions -->
        <div class="test-section">
            <h2>How to Use</h2>
            <ol>
                <li><strong>Check System Status:</strong> Verify that cart.js and shop.js are loaded</li>
                <li><strong>Run Tests:</strong> Execute integration tests to verify functionality</li>
                <li><strong>View Cart Data:</strong> See the actual cart data stored in localStorage</li>
                <li><strong>Test Full Flow:</strong> 
                    <ol>
                        <li>Add products using the test buttons</li>
                        <li>Navigate to cart.html</li>
                        <li>Verify products appear in the cart table</li>
                        <li>Go back to shop.html and add more products</li>
                        <li>Return to cart.html and verify they merge</li>
                    </ol>
                </li>
            </ol>
        </div>

        <!-- Flow Diagram -->
        <div class="test-section">
            <h2>Data Flow</h2>
            <div class="code-block">
shop.html (display products)
    ‚Üì
shop.js (displayProducts)
    ‚Üì
shopProducts array ‚Üí generate HTML
    ‚Üì
User clicks "Add to Cart"
    ‚Üì
attachCartEventListeners() ‚Üí cartManager.addToCart()
    ‚Üì
Product saved to localStorage.cart
    ‚Üì
cart.html loads
    ‚Üì
cart.js reads localStorage
    ‚Üì
displayCartTable() ‚Üí shows in cart table
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-links">
            <strong>Navigate to:</strong><br><br>
            <a href="shop.html">üè™ Shop Page</a>
            <a href="cart.html">üõí Cart Page</a>
            <a href="index.html">üè† Home Page</a>
        </div>

        <!-- Utility Buttons -->
        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #ddd;">
            <strong>Utilities:</strong>
            <div class="button-group">
                <button class="btn-success" onclick="clearLocalStorage()">Clear LocalStorage</button>
                <button class="btn-danger" onclick="resetAllTests()">Reset Tests</button>
                <button class="btn-primary" onclick="logFullState()">Log Full State</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize tests on load
        window.addEventListener('load', () => {
            checkSystemStatus();
            loadProductsTable();
        });

        // Check system status
        function checkSystemStatus() {
            // Check cart.js
            if (typeof CartManager !== 'undefined') {
                document.getElementById('cart-js-status').textContent = '‚úÖ Loaded';
                document.getElementById('cart-js-status').style.color = '#28a745';
            } else {
                document.getElementById('cart-js-status').textContent = '‚ùå Not Found';
                document.getElementById('cart-js-status').style.color = '#dc3545';
            }

            // Check cartManager
            if (typeof cartManager !== 'undefined') {
                document.getElementById('cartmanager-status').textContent = '‚úÖ Initialized';
                document.getElementById('cartmanager-status').style.color = '#28a745';
                document.getElementById('cartmanager-details').textContent = 
                    `Cart items: ${cartManager.cart.length}`;
            } else {
                document.getElementById('cartmanager-status').textContent = '‚ùå Not Initialized';
                document.getElementById('cartmanager-status').style.color = '#dc3545';
            }

            // Check localStorage
            if (typeof(Storage) !== "undefined") {
                document.getElementById('storage-status').textContent = '‚úÖ Available';
                document.getElementById('storage-status').style.color = '#28a745';
                const cartData = localStorage.getItem('cart');
                document.getElementById('storage-data').textContent = cartData ? 
                    `${JSON.parse(cartData).length} items` : 'empty';
            } else {
                document.getElementById('storage-status').textContent = '‚ùå Not Available';
                document.getElementById('storage-status').style.color = '#dc3545';
            }
        }

        // Load products table
        function loadProductsTable() {
            if (typeof shopProducts !== 'undefined') {
                const tbody = document.getElementById('products-tbody');
                tbody.innerHTML = shopProducts.map(product => `
                    <tr>
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>$${product.price.toFixed(2)}</td>
                        <td><img src="${product.image}" style="width: 50px; height: 50px; object-fit: cover;"></td>
                        <td>${product.description}</td>
                    </tr>
                `).join('');
            }
        }

        // Test add to cart
        function testAddToCart() {
            const resultDiv = document.getElementById('test-add-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '';

            if (typeof cartManager === 'undefined') {
                resultDiv.innerHTML = '<strong style="color: #dc3545;">‚ùå cartManager not initialized</strong>';
                return;
            }

            if (typeof shopProducts === 'undefined' || shopProducts.length === 0) {
                resultDiv.innerHTML = '<strong style="color: #dc3545;">‚ùå No products available</strong>';
                return;
            }

            try {
                const product = shopProducts[0];
                const cartBefore = cartManager.cart.length;
                
                cartManager.addToCart(product, 1);
                
                const cartAfter = cartManager.cart.length;
                
                resultDiv.innerHTML = `
                    <strong style="color: #28a745;">‚úÖ Product Added Successfully</strong><br><br>
                    <strong>Product:</strong> ${product.name}<br>
                    <strong>Price:</strong> $${product.price.toFixed(2)}<br>
                    <strong>Cart Items Before:</strong> ${cartBefore}<br>
                    <strong>Cart Items After:</strong> ${cartAfter}<br>
                    <strong>Status:</strong> Added to cart and localStorage updated
                `;
                
                checkSystemStatus();
            } catch (error) {
                resultDiv.innerHTML = `<strong style="color: #dc3545;">‚ùå Error: ${error.message}</strong>`;
            }
        }

        // Test product structure
        function testProductStructure() {
            const resultDiv = document.getElementById('test-structure-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '';

            if (typeof shopProducts === 'undefined') {
                resultDiv.innerHTML = '<strong style="color: #dc3545;">‚ùå shopProducts not defined</strong>';
                return;
            }

            if (shopProducts.length === 0) {
                resultDiv.innerHTML = '<strong style="color: #dc3545;">‚ùå shopProducts array is empty</strong>';
                return;
            }

            const product = shopProducts[0];
            const requiredFields = ['id', 'name', 'price', 'image', 'description'];
            const missingFields = requiredFields.filter(field => !(field in product));

            if (missingFields.length > 0) {
                resultDiv.innerHTML = `
                    <strong style="color: #dc3545;">‚ùå Missing fields: ${missingFields.join(', ')}</strong>
                `;
            } else {
                resultDiv.innerHTML = `
                    <strong style="color: #28a745;">‚úÖ Product Structure Valid</strong><br><br>
                    <strong>Total Products:</strong> ${shopProducts.length}<br>
                    <strong>Required Fields Present:</strong> ${requiredFields.join(', ')}<br><br>
                    <strong>Sample Product:</strong><br>
                    ${JSON.stringify(product, null, 2)}
                `;
            }
        }

        // Test cart persistence
        function testCartPersistence() {
            const resultDiv = document.getElementById('test-persistence-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '';

            if (typeof(Storage) === "undefined") {
                resultDiv.innerHTML = '<strong style="color: #dc3545;">‚ùå localStorage not available</strong>';
                return;
            }

            try {
                const cartData = localStorage.getItem('cart');
                if (!cartData) {
                    resultDiv.innerHTML = '<strong style="color: #ffc107;">‚ö†Ô∏è No cart data in localStorage yet</strong>';
                    return;
                }

                const cart = JSON.parse(cartData);
                const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

                resultDiv.innerHTML = `
                    <strong style="color: #28a745;">‚úÖ Cart Persistence Working</strong><br><br>
                    <strong>Total Items:</strong> ${cart.length}<br>
                    <strong>Total Value:</strong> $${totalPrice.toFixed(2)}<br><br>
                    <strong>Items in Cart:</strong><br>
                    <ul>
                        ${cart.map(item => `
                            <li>${item.name} (x${item.quantity}) - $${(item.price * item.quantity).toFixed(2)}</li>
                        `).join('')}
                    </ul>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<strong style="color: #dc3545;">‚ùå Error: ${error.message}</strong>`;
            }
        }

        // View cart data
        function viewCartData() {
            const resultDiv = document.getElementById('storage-view');
            resultDiv.style.display = 'block';

            const cartData = localStorage.getItem('cart');
            if (!cartData) {
                resultDiv.textContent = 'No cart data in localStorage';
                return;
            }

            try {
                const cart = JSON.parse(cartData);
                resultDiv.textContent = JSON.stringify(cart, null, 2);
            } catch (error) {
                resultDiv.textContent = `Error parsing cart data: ${error.message}`;
            }
        }

        // Clear localStorage
        function clearLocalStorage() {
            if (confirm('Clear all cart data from localStorage?')) {
                localStorage.clear();
                if (typeof cartManager !== 'undefined') {
                    cartManager.cart = [];
                }
                checkSystemStatus();
                alert('localStorage cleared');
            }
        }

        // Reset all tests
        function resetAllTests() {
            document.querySelectorAll('[id$="-result"]').forEach(el => {
                el.style.display = 'none';
                el.innerHTML = '';
            });
            document.getElementById('storage-view').style.display = 'none';
            checkSystemStatus();
        }

        // Log full state
        function logFullState() {
            console.log('=== Full System State ===');
            console.log('cartManager:', typeof cartManager !== 'undefined' ? cartManager : 'undefined');
            console.log('shopProducts:', typeof shopProducts !== 'undefined' ? shopProducts : 'undefined');
            console.log('localStorage.cart:', localStorage.getItem('cart') || 'empty');
            console.log('========================');
            alert('Full state logged to console. Open DevTools to see.');
        }
    </script>
</body>
</html>
